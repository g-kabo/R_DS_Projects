<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Me" />


<title>OkCupid Data</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
      </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Personal Website</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="NYC_Flights_EDA.html">NYC Flights EDA</a>
</li>
<li>
  <a href="NYC_Flights_TidyModel.html">NYC Flights with Tidymodels</a>
</li>
<li>
  <a href="OKCupidDataAnalysis.html">OK Cupid</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">OkCupid Data</h1>
<h4 class="author">Me</h4>
<h4 class="date">14/10/2020</h4>

</div>


<p>We will investigate the OKCupid Data and see if we can predict if a user is a STEM major or not, based on the data provided. First we will perform some EDA to look at the data, and then we will use the Tidymodels framework to easily create machine learning models. If you wish to view the results, use the contents tab on the left to skip to the <strong>Performance on Test Set</strong> section.</p>
<pre class="r"><code>library(modeldata)
library(tidyverse)
library(skimr)
library(tidymodels)</code></pre>
<div id="eda" class="section level1">
<h1><span class="header-section-number">1</span> EDA</h1>
<div id="basic-eda" class="section level2">
<h2><span class="header-section-number">1.1</span> Basic EDA</h2>
<pre class="r"><code>data(&quot;okc&quot;)

skim(okc)</code></pre>
<table>
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">okc</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">59855</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">6</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">Date</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">factor</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">2</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">diet</td>
<td align="right">24360</td>
<td align="right">0.59</td>
<td align="right">5</td>
<td align="right">19</td>
<td align="right">0</td>
<td align="right">18</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">location</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">4</td>
<td align="right">19</td>
<td align="right">0</td>
<td align="right">135</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: Date</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">min</th>
<th align="left">max</th>
<th align="left">median</th>
<th align="right">n_unique</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">date</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">2011-06-27</td>
<td align="left">2012-07-01</td>
<td align="left">2012-06-27</td>
<td align="right">371</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">ordered</th>
<th align="right">n_unique</th>
<th align="left">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Class</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">2</td>
<td align="left">oth: 50316, ste: 9539</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">age</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">32.34</td>
<td align="right">9.46</td>
<td align="right">18</td>
<td align="right">26</td>
<td align="right">30</td>
<td align="right">37</td>
<td align="right">110</td>
<td align="left">▇▂▁▁▁</td>
</tr>
<tr class="even">
<td align="left">height</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">68.29</td>
<td align="right">3.99</td>
<td align="right">1</td>
<td align="right">66</td>
<td align="right">68</td>
<td align="right">71</td>
<td align="right">95</td>
<td align="left">▁▁▁▇▁</td>
</tr>
</tbody>
</table>
<pre class="r"><code>okc %&gt;%
  ggplot(aes(x=age))+
  geom_histogram(binwidth = 1,fill=&quot;pink&quot;)+
  theme_minimal()+
  labs(title=&quot;OKC Users Tends To Be Young, The Most common Age Being 26&quot;,subtitle=&quot;Age Distribution of OKC Users&quot;,x=&quot;Age&quot;,y=&quot;Count&quot;)+
  geom_vline(xintercept = 26, col=&quot;red&quot;,lty=2)</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code>okc %&gt;%
  filter(height &gt; 30)%&gt;%
  mutate(height = height/0.39370 )%&gt;%
  ggplot(aes(x=height))+
  geom_histogram(bins=30,fill=&quot;pink&quot;)+
  theme_minimal()+
  labs(title=&quot;The Average OKC User was 175cm tall&quot;,subtitle=&quot;Height Distribution of OKC Users&quot;,x=&quot;Height (cm)&quot;,y=&quot;Count&quot;)</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<pre class="r"><code>okc %&gt;%
  mutate(diet = str_remove(diet,&quot;strictly&quot;),
         diet = str_remove(diet,&quot;mostly&quot;),
         diet = str_remove(diet, &quot; &quot;),
         diet = str_to_title(diet),
         )%&gt;%
  count(diet)%&gt;%
  arrange(desc(n))%&gt;%
  ggplot(aes(x=n,y=reorder(diet,n),fill=diet))+
  geom_col(show.legend = F)+
  geom_text(aes(label=n),hjust=-.1)+
  theme_minimal()+
  lims(x=c(0,31000))+
  labs(title = &quot;OKC Users Were Not Picky Eaters&quot;,subtitle=&quot;Total Count of Diets&quot;,x=&quot;Count&quot;,y=&quot;Diet&quot;)</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<pre class="r"><code>okc %&gt;%
  mutate(location = fct_lump_n(location,n=10) )%&gt;%
  mutate (location =  str_to_title(location))%&gt;%
  count(location) %&gt;%
  arrange(-n)%&gt;%
  ggplot(aes(x=n,y=reorder(location,n),fill=location))+
  geom_col(show.legend = F)+
  geom_text(aes(label=n),hjust=-.1)+
  theme_minimal()+
  lims(x=c(0,35000))+
  labs(title = &quot;Most OKC Users were from San Francisco&quot;,subtitle=&quot;Top 10 Most Common Locations&quot;,x=&quot;Count&quot;,y=&quot;Location&quot;)</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<pre class="r"><code>okc %&gt;%
  count(Class)%&gt;%
  mutate(prop=n/sum(n)) %&gt;%
  ggplot(aes(x=Class,y=prop,fill=Class))+
  geom_col(show.legend = FALSE)+
  theme_minimal()+
  scale_y_continuous(labels=scales::percent_format(),limits = c(0,1))+
  geom_text(aes(label= paste(round(prop*100),&quot;%&quot;),vjust=-.1) )+
  labs(title=&quot;STEM Students were in the Minority&quot;,subtitle=&quot;Percent of Users in STEM&quot;,x=&quot;Major&quot;,y=&quot;Percent&quot;)</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Were the age demographics different for different locations?</p>
<pre class="r"><code>okc %&gt;%
  mutate(location = fct_lump_n(location,n=10) )%&gt;%
  mutate (location =  str_to_title(location)) %&gt;%
  ggplot(aes(x=reorder(location,age),y=age,fill=location))+
  #geom_violin(show.legend = F,draw_quantiles = c(.25,.50,.75))+
  geom_boxplot(show.legend = F)+
  theme_minimal()+
  labs(title=&quot;Age Distribution of 10 Most Populated Locations&quot;,x=&quot;Location&quot;,y=&quot;Age&quot;)</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<pre class="r"><code>okc %&gt;%
  mutate(diet = str_remove(diet,&quot;strictly&quot;),
         diet = str_remove(diet,&quot;mostly&quot;),
         diet = str_remove(diet, &quot; &quot;),
         diet = str_to_title(diet),
     location = fct_lump_n(location,n=15),
     location =  str_to_title(location)
  )%&gt;%
  group_by(location)%&gt;%
  count(diet)%&gt;%
  ungroup()%&gt;%
  ggplot(aes(x=n,   y=tidytext::reorder_within(diet,n,location),fill=diet ))+
  geom_col(show.legend = F)+
  facet_wrap(.~location,scales = &quot;free&quot;)+
  tidytext::scale_y_reordered()+
  #geom_text(aes(label=n,),hjust=.5)+
  theme_minimal()+
  labs(title=&quot;Most Common Diets by Top 16 Most Populated Areas&quot;,x=NULL,y=NULL)</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<pre class="r"><code>okc %&gt;%
  filter(height &gt; 30)%&gt;%
  na.omit(height)%&gt;%
  group_by(location)%&gt;%
mutate( avg_height = mean(height),
          avg_age = mean(age)
  )%&gt;%
  ungroup()%&gt;%
  distinct(location,.keep_all = TRUE) %&gt;%
  ggplot(aes(x=avg_age,y=avg_height))+
  geom_point(col=&quot;red&quot;)+
  geom_text(aes(label=location))+
  theme_minimal()+
  labs(title=&quot;Average Age and Height of OKC Users by Location&quot;,x=&quot;Average Age&quot;,y=&quot;Average Height&quot;)</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<pre class="r"><code>okc %&gt;%
  #filter( !is.na(diet)) %&gt;%
  mutate(diet = str_remove(diet,&quot;strictly&quot;),
         diet = str_remove(diet,&quot;mostly&quot;),
         diet = str_remove(diet, &quot; &quot;),
         diet = str_to_title(diet),
     location = fct_lump_n(location,n=15),
     location =  str_to_title(location)
  ) %&gt;%
  group_by(diet,Class)%&gt;%
  count(diet)%&gt;%
  ungroup(diet)%&gt;%
  mutate(prop=n/sum(n)) %&gt;%
  ggplot(aes(x=reorder(diet,-prop),y=prop,fill=Class))+
  geom_col(position = position_dodge())+
  geom_text(aes(label=  paste0(  round(prop*100,1),&quot;%&quot; ) ),position = position_dodge(width = 1),vjust=-.5)+
  scale_y_continuous(labels = scales::percent_format())+
  labs(title=&quot;Dietary Difference Between Major&quot;,subtitle = &quot;Proportion of Diet Amongst Major&quot;,x=&quot;Diet&quot;,y=&quot;Percent&quot;,fill=&quot;Class:&quot;)+
    theme_minimal()+
  theme(legend.position = &quot;top&quot;,
        panel.grid.major.x = element_blank() )</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<pre class="r"><code>ggplot(okc,aes(x=Class,y=age,fill=Class))+
  geom_violin(draw_quantiles = c(.25,.5,.75),show.legend = F)+
  theme_minimal()+
  labs(title=&quot;Age Distribution By Major&quot;)</code></pre>
<pre><code>## Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
## collapsing to unique &#39;x&#39; values</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<pre class="r"><code>okc %&gt;%
  filter(height &gt; 25) %&gt;%
ggplot(aes(x=Class,y=height,fill=Class))+
  geom_violin(draw_quantiles = c(.25,.5,.75),show.legend = F)+
  #geom_boxplot(show.legend = F)+
  theme_minimal()+
  labs(title=&quot;Height Distribution By Major&quot;,y=&quot;Height (Inches)&quot;)</code></pre>
<pre><code>## Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
## collapsing to unique &#39;x&#39; values</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<pre class="r"><code>okc %&gt;%
  filter(height &gt; 25) %&gt;%
  mutate(diet = str_remove(diet,&quot;strictly&quot;),
         diet = str_remove(diet,&quot;mostly&quot;),
         diet = str_remove(diet, &quot; &quot;),
         diet = str_to_title(diet),
  )%&gt;%
    ggplot(aes(x=reorder(diet,height),y=height,fill=diet))+
    geom_violin(  draw_quantiles = c(.25,.5,.75),show.legend = FALSE)+
    theme_minimal()+
   labs(title=&quot;Height Difference Across Diets&quot;,x=&quot;Diet&quot;,y=&quot;Height (Inches)&quot;)</code></pre>
<pre><code>## Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
## collapsing to unique &#39;x&#39; values

## Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
## collapsing to unique &#39;x&#39; values

## Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
## collapsing to unique &#39;x&#39; values</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<pre class="r"><code>okc %&gt;%
  na.omit() %&gt;%
  filter(height &gt; 25) %&gt;%
  mutate(diet = str_remove(diet,&quot;strictly&quot;),
         diet = str_remove(diet,&quot;mostly&quot;),
         diet = str_remove(diet, &quot; &quot;),
         diet = str_to_title(diet),
  )%&gt;%
    ggplot(aes(x=diet,y=height,fill=interaction(diet,Class) )   ) + #Use fill=interaction(Class,diet) for better colouring - doesn&#39;t work here due to NAs
    geom_violin(  draw_quantiles = c(.25,.5,.75))+
    theme_minimal()+
   labs(title=&quot;Height Difference Majors Across Diets&quot;,subtitle =&quot;Left is STEM, Right is Others&quot; ,x=&quot;Diet&quot;,y=&quot;Height (Inches)&quot;)+
   scale_fill_manual(values=c(&quot;darkslategray4&quot;,&quot;firebrick4&quot;,&quot;palegreen4&quot;,&quot;slateblue4&quot;,&quot;royalblue3&quot;,&quot;darkgoldenrod4&quot;,
              &quot;darkslategray1&quot;,&quot;firebrick2&quot;,&quot;palegreen1&quot;,&quot;slateblue2&quot;,&quot;royalblue1&quot;,&quot;darkgoldenrod1&quot;))+
  theme(legend.position = &quot;right&quot;)+
  guides(fill=guide_legend(ncol=2))</code></pre>
<pre><code>## Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
## collapsing to unique &#39;x&#39; values

## Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
## collapsing to unique &#39;x&#39; values

## Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
## collapsing to unique &#39;x&#39; values</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<pre class="r"><code>okc %&gt;%
  na.omit() %&gt;%
  filter(height &gt; 25) %&gt;%
  mutate(diet = str_remove(diet,&quot;strictly&quot;),
         diet = str_remove(diet,&quot;mostly&quot;),
         diet = str_remove(diet, &quot; &quot;),
         diet = str_to_title(diet),
  )%&gt;%
    ggplot(aes(x= tidytext::reorder_within(diet,height,Class)
               ,y=height,fill=diet)) + #Use fill=interaction(Class,diet) for better colouring - doesn&#39;t work here due to NAs
    #geom_violin(  draw_quantiles = c(.25,.5,.75))+
  geom_boxplot()+
  facet_wrap(.~Class,nrow=2,scales = &quot;free_x&quot;)+
    theme_bw()+
   labs(title=&quot;STEM Majors Who Followed A Kosher Diet Were Tallest For That Group,\nWhile Vegans Were The Shortest&quot;,x=&quot;Diet&quot;,y=&quot;Height (Inches)&quot;)+
   scale_fill_manual(values=c(&quot;darkslategray4&quot;,&quot;firebrick4&quot;,&quot;palegreen4&quot;,&quot;slateblue4&quot;,&quot;royalblue3&quot;,&quot;darkgoldenrod4&quot;))+
  theme(legend.position = &quot;none&quot;)+
  tidytext::scale_x_reordered()</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>Seeing which combination of diet and class has the tallest individuals on average.</p>
<pre class="r"><code>okc %&gt;%
  #na.omit() %&gt;%
  filter(height &gt; 25) %&gt;%
  mutate(diet = str_remove(diet,&quot;strictly&quot;),
         diet = str_remove(diet,&quot;mostly&quot;),
         diet = str_remove(diet, &quot; &quot;),
         diet = str_to_title(diet),
  ) %&gt;%
  group_by(Class,diet)%&gt;%
  summarise(avg_height = mean(height),.groups=&quot;keep&quot;) %&gt;%
  mutate( avg_height = avg_height/0.39370) %&gt;%
  arrange(-avg_height) %&gt;%
  ungroup() %&gt;%
  pivot_wider(names_from = Class,values_from=avg_height)%&gt;%
  mutate( avg = (stem+other)/2 )%&gt;%
  arrange(-avg)</code></pre>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">diet</th>
<th align="right">stem</th>
<th align="right">other</th>
<th align="right">avg</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Halal</td>
<td align="right">176.8234</td>
<td align="right">176.7685</td>
<td align="right">176.7960</td>
</tr>
<tr class="even">
<td align="left">Kosher</td>
<td align="right">179.7054</td>
<td align="right">172.9669</td>
<td align="right">176.3362</td>
</tr>
<tr class="odd">
<td align="left">Anything</td>
<td align="right">176.8687</td>
<td align="right">173.3305</td>
<td align="right">175.0996</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="right">176.5763</td>
<td align="right">172.7735</td>
<td align="right">174.6749</td>
</tr>
<tr class="odd">
<td align="left">Other</td>
<td align="right">175.9794</td>
<td align="right">173.1469</td>
<td align="right">174.5632</td>
</tr>
<tr class="even">
<td align="left">Vegetarian</td>
<td align="right">176.0799</td>
<td align="right">170.9882</td>
<td align="right">173.5341</td>
</tr>
<tr class="odd">
<td align="left">Vegan</td>
<td align="right">173.6186</td>
<td align="right">171.7596</td>
<td align="right">172.6891</td>
</tr>
</tbody>
</table>
</div>
<pre class="r"><code>okc %&gt;%
  na.omit() %&gt;%
  filter(height &gt; 25) %&gt;%
  mutate(diet = str_remove(diet,&quot;strictly&quot;),
         diet = str_remove(diet,&quot;mostly&quot;),
         diet = str_remove(diet, &quot; &quot;),
         diet = str_to_title(diet),
  )%&gt;%
    ggplot(aes(x=diet,y=age,fill=interaction(diet,Class) )   ) + #Use fill=interaction(Class,diet) for better colouring - doesn&#39;t work here due to NAs
    geom_violin(  draw_quantiles = c(.25,.5,.75))+
    theme_minimal()+
   labs(title=&quot;Age by Diet and Class&quot;,x=&quot;Diet&quot;,y=&quot;Age&quot;)+
   scale_fill_manual(values=c(&quot;darkslategray4&quot;,&quot;firebrick4&quot;,&quot;palegreen4&quot;,&quot;slateblue4&quot;,&quot;royalblue3&quot;,&quot;darkgoldenrod4&quot;,
              &quot;darkslategray1&quot;,&quot;firebrick2&quot;,&quot;palegreen1&quot;,&quot;slateblue2&quot;,&quot;royalblue1&quot;,&quot;darkgoldenrod1&quot;))+
  theme(legend.position = &quot;right&quot;)+
  guides(fill=guide_legend(ncol=2))</code></pre>
<pre><code>## Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
## collapsing to unique &#39;x&#39; values</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Is there a difference between major in different locations?</p>
<pre class="r"><code>okc %&gt;%
  #filter( !is.na(diet)) %&gt;%
  mutate(location = fct_lump_prop(location,prop=0.01),
         location =  str_to_title(location)
  ) %&gt;%
  group_by(location,Class)%&gt;%
  count(location)%&gt;%
  ungroup(Class)%&gt;%
  mutate(prop=n/sum(n)) %&gt;%
  ungroup() %&gt;%
  ggplot(aes(x= location,y=prop,fill=Class))+
  geom_col(position = position_stack() )+
  geom_text(aes(label=  paste0(  round(prop*100,1),&quot;%&quot; ) ), position = position_stack(vjust = 0.5)  )+
  scale_y_continuous(labels = scales::percent_format())+
  labs(title=&quot;Major Difference Between Top 99% of Most Populated Locations&quot;,x=&quot;Location&quot;,y=&quot;Percent&quot;,fill=&quot;Class:&quot;)+
  theme_minimal()+
  theme(legend.position = &quot;top&quot;,
        panel.grid.major.x = element_blank() )+
  coord_flip()+
  guides(fill = guide_legend(reverse=TRUE))</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<pre class="r"><code>okc %&gt;%
  #filter( !is.na(diet)) %&gt;%
  mutate(location = fct_lump_prop(location,prop=0.05),
         location =  str_to_title(location)
  ) %&gt;%
  group_by(location,Class)%&gt;%
  count(location)%&gt;%
  ungroup(Class)%&gt;%
  mutate(prop=n/sum(n)) %&gt;%
  ungroup() %&gt;%
  ggplot(aes(x= location,y=prop,fill=Class))+
  geom_col(position = position_stack() )+
  geom_text(aes(label=  paste0(  round(prop*100,1),&quot;%&quot; ) ), position = position_stack(vjust = 0.5)  )+
  scale_y_continuous(labels = scales::percent_format())+
  labs(title=&quot;Major Difference Between Top 95% of Most Populated Locations&quot;,x=&quot;Location&quot;,y=&quot;Percent&quot;,fill=&quot;Class:&quot;)+
  theme_minimal()+
  theme(legend.position = &quot;top&quot;,
        panel.grid.major.x = element_blank() )+
  coord_flip()+
  guides(fill = guide_legend(reverse=TRUE))</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
</div>
</div>
<div id="tidy-models" class="section level1">
<h1><span class="header-section-number">2</span> Tidy Models</h1>
<div id="creating-model-data" class="section level2">
<h2><span class="header-section-number">2.1</span> Creating Model Data</h2>
<p>Armed with the information gathered from the EDA process, we can create a cleaned dataset to model on.</p>
<pre class="r"><code>okc_clean = okc %&gt;%
  filter( height&gt;25) %&gt;%
  mutate(diet = str_remove(diet,&quot;strictly&quot;),
         diet = str_remove(diet,&quot;mostly&quot;),
         diet = str_remove(diet, &quot; &quot;),
         diet = str_to_title(diet),
         diet = factor(diet),
         location = fct_lump_prop(location,prop=0.05), #Lump people who appear less than 5% as Other
         location =  str_to_title(location),
         location = factor(location))%&gt;%
  select(-date)</code></pre>
<pre class="r"><code>skim(okc_clean)</code></pre>
<table>
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">okc_clean</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">59847</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">5</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">factor</td>
<td align="left">3</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">2</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">ordered</th>
<th align="right">n_unique</th>
<th align="left">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">diet</td>
<td align="right">24355</td>
<td align="right">0.59</td>
<td align="left">FALSE</td>
<td align="right">6</td>
<td align="left">Any: 27841, Veg: 4976, Oth: 1785, Veg: 698</td>
</tr>
<tr class="even">
<td align="left">location</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="left">FALSE</td>
<td align="right">4</td>
<td align="left">San: 31061, Oth: 17364, Oak: 7213, Ber: 4209</td>
</tr>
<tr class="odd">
<td align="left">Class</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="left">FALSE</td>
<td align="right">2</td>
<td align="left">oth: 50310, ste: 9537</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">age</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">32.34</td>
<td align="right">9.46</td>
<td align="right">18</td>
<td align="right">26</td>
<td align="right">30</td>
<td align="right">37</td>
<td align="right">110</td>
<td align="left">▇▂▁▁▁</td>
</tr>
<tr class="even">
<td align="left">height</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">68.30</td>
<td align="right">3.94</td>
<td align="right">26</td>
<td align="right">66</td>
<td align="right">68</td>
<td align="right">71</td>
<td align="right">95</td>
<td align="left">▁▁▆▇▁</td>
</tr>
</tbody>
</table>
<pre class="r"><code>set.seed(8888)

okc_split = initial_split(okc_clean,strata = Class)

okc_train = training(okc_split)
okc_test = testing(okc_split)</code></pre>
</div>
<div id="create-a-recipie" class="section level2">
<h2><span class="header-section-number">2.2</span> Create A Recipie</h2>
<pre class="r"><code>okc_rec = recipe(Class~.,data=okc_train) %&gt;%
  themis::step_downsample(Class) %&gt;%
  step_unknown(diet) %&gt;%
  step_dummy(all_nominal(),-all_outcomes()) %&gt;%
  step_zv(all_predictors())</code></pre>
<pre><code>## Registered S3 methods overwritten by &#39;themis&#39;:
##   method               from   
##   bake.step_downsample recipes
##   bake.step_upsample   recipes
##   prep.step_downsample recipes
##   prep.step_upsample   recipes
##   tidy.step_downsample recipes
##   tidy.step_upsample   recipes</code></pre>
<pre class="r"><code>tree_rec = recipe(Class~.,data=okc_train) %&gt;%
  step_unknown(diet)</code></pre>
</div>
<div id="set-model-spec" class="section level2">
<h2><span class="header-section-number">2.3</span> Set Model Spec</h2>
<pre class="r"><code>lgst_mod = logistic_reg() %&gt;%
  set_engine(&quot;glm&quot;)

tree_mod = decision_tree(cost_complexity = tune(),
                          min_n = tune(),
                          tree_depth = tune()) %&gt;%
  set_engine(&quot;rpart&quot;)%&gt;%
  set_mode(&quot;classification&quot;)</code></pre>
</div>
<div id="creating-worflow" class="section level2">
<h2><span class="header-section-number">2.4</span> Creating Worflow</h2>
<pre class="r"><code>lgst_wf = workflow() %&gt;%
    add_model(lgst_mod) %&gt;%
    add_recipe(okc_rec)

tree_wf = workflow() %&gt;%
  add_model(tree_mod)%&gt;%
  add_recipe(tree_rec)</code></pre>
<div id="finding-the-hyperparameters-for-tree-model" class="section level3">
<h3><span class="header-section-number">2.4.1</span> Finding the Hyperparameters For Tree Model</h3>
<pre class="r"><code>#doParallel::registerDoParallel()

start = Sys.time()

set.seed(8888)
tree_res = tree_wf %&gt;%
  tune_grid(    resamples = vfold_cv(okc_train,strata = Class),
                grid =  grid_max_entropy(cost_complexity(), min_n(),tree_depth(),size=20 ),
                control = control_grid(save_pred = TRUE))

#doParallel:::stopImplicitCluster()

end = Sys.time()

paste(&quot;Time Taken:&quot;,end-start)</code></pre>
<pre><code>## [1] &quot;Time Taken: 1.93076254924138&quot;</code></pre>
<pre class="r"><code>tree_res %&gt;%
  collect_metrics()</code></pre>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">cost_complexity</th>
<th align="right">tree_depth</th>
<th align="right">min_n</th>
<th align="left">.metric</th>
<th align="left">.estimator</th>
<th align="right">mean</th>
<th align="right">n</th>
<th align="right">std_err</th>
<th align="left">.config</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.0002728</td>
<td align="right">8</td>
<td align="right">17</td>
<td align="left">accuracy</td>
<td align="left">binary</td>
<td align="right">0.8406407</td>
<td align="right">10</td>
<td align="right">0.0000232</td>
<td align="left">Model01</td>
</tr>
<tr class="even">
<td align="right">0.0002728</td>
<td align="right">8</td>
<td align="right">17</td>
<td align="left">roc_auc</td>
<td align="left">binary</td>
<td align="right">0.5000000</td>
<td align="right">10</td>
<td align="right">0.0000000</td>
<td align="left">Model01</td>
</tr>
<tr class="odd">
<td align="right">0.0000001</td>
<td align="right">1</td>
<td align="right">24</td>
<td align="left">accuracy</td>
<td align="left">binary</td>
<td align="right">0.8406407</td>
<td align="right">10</td>
<td align="right">0.0000232</td>
<td align="left">Model02</td>
</tr>
<tr class="even">
<td align="right">0.0000001</td>
<td align="right">1</td>
<td align="right">24</td>
<td align="left">roc_auc</td>
<td align="left">binary</td>
<td align="right">0.5000000</td>
<td align="right">10</td>
<td align="right">0.0000000</td>
<td align="left">Model02</td>
</tr>
<tr class="odd">
<td align="right">0.0000042</td>
<td align="right">6</td>
<td align="right">3</td>
<td align="left">accuracy</td>
<td align="left">binary</td>
<td align="right">0.8405962</td>
<td align="right">10</td>
<td align="right">0.0000492</td>
<td align="left">Model03</td>
</tr>
<tr class="even">
<td align="right">0.0000042</td>
<td align="right">6</td>
<td align="right">3</td>
<td align="left">roc_auc</td>
<td align="left">binary</td>
<td align="right">0.6079312</td>
<td align="right">10</td>
<td align="right">0.0033329</td>
<td align="left">Model03</td>
</tr>
<tr class="odd">
<td align="right">0.0787769</td>
<td align="right">12</td>
<td align="right">20</td>
<td align="left">accuracy</td>
<td align="left">binary</td>
<td align="right">0.8406407</td>
<td align="right">10</td>
<td align="right">0.0000232</td>
<td align="left">Model04</td>
</tr>
<tr class="even">
<td align="right">0.0787769</td>
<td align="right">12</td>
<td align="right">20</td>
<td align="left">roc_auc</td>
<td align="left">binary</td>
<td align="right">0.5000000</td>
<td align="right">10</td>
<td align="right">0.0000000</td>
<td align="left">Model04</td>
</tr>
<tr class="odd">
<td align="right">0.0000000</td>
<td align="right">2</td>
<td align="right">39</td>
<td align="left">accuracy</td>
<td align="left">binary</td>
<td align="right">0.8406407</td>
<td align="right">10</td>
<td align="right">0.0000232</td>
<td align="left">Model05</td>
</tr>
<tr class="even">
<td align="right">0.0000000</td>
<td align="right">2</td>
<td align="right">39</td>
<td align="left">roc_auc</td>
<td align="left">binary</td>
<td align="right">0.5000000</td>
<td align="right">10</td>
<td align="right">0.0000000</td>
<td align="left">Model05</td>
</tr>
<tr class="odd">
<td align="right">0.0425398</td>
<td align="right">3</td>
<td align="right">20</td>
<td align="left">accuracy</td>
<td align="left">binary</td>
<td align="right">0.8406407</td>
<td align="right">10</td>
<td align="right">0.0000232</td>
<td align="left">Model06</td>
</tr>
<tr class="even">
<td align="right">0.0425398</td>
<td align="right">3</td>
<td align="right">20</td>
<td align="left">roc_auc</td>
<td align="left">binary</td>
<td align="right">0.5000000</td>
<td align="right">10</td>
<td align="right">0.0000000</td>
<td align="left">Model06</td>
</tr>
<tr class="odd">
<td align="right">0.0000000</td>
<td align="right">13</td>
<td align="right">2</td>
<td align="left">accuracy</td>
<td align="left">binary</td>
<td align="right">0.8339795</td>
<td align="right">10</td>
<td align="right">0.0005051</td>
<td align="left">Model07</td>
</tr>
<tr class="even">
<td align="right">0.0000000</td>
<td align="right">13</td>
<td align="right">2</td>
<td align="left">roc_auc</td>
<td align="left">binary</td>
<td align="right">0.6326370</td>
<td align="right">10</td>
<td align="right">0.0028302</td>
<td align="left">Model07</td>
</tr>
<tr class="odd">
<td align="right">0.0000028</td>
<td align="right">11</td>
<td align="right">4</td>
<td align="left">accuracy</td>
<td align="left">binary</td>
<td align="right">0.8379674</td>
<td align="right">10</td>
<td align="right">0.0001622</td>
<td align="left">Model08</td>
</tr>
<tr class="even">
<td align="right">0.0000028</td>
<td align="right">11</td>
<td align="right">4</td>
<td align="left">roc_auc</td>
<td align="left">binary</td>
<td align="right">0.6370359</td>
<td align="right">10</td>
<td align="right">0.0037158</td>
<td align="left">Model08</td>
</tr>
<tr class="odd">
<td align="right">0.0001168</td>
<td align="right">13</td>
<td align="right">39</td>
<td align="left">accuracy</td>
<td align="left">binary</td>
<td align="right">0.8406407</td>
<td align="right">10</td>
<td align="right">0.0000232</td>
<td align="left">Model09</td>
</tr>
<tr class="even">
<td align="right">0.0001168</td>
<td align="right">13</td>
<td align="right">39</td>
<td align="left">roc_auc</td>
<td align="left">binary</td>
<td align="right">0.5000000</td>
<td align="right">10</td>
<td align="right">0.0000000</td>
<td align="left">Model09</td>
</tr>
<tr class="odd">
<td align="right">0.0000150</td>
<td align="right">8</td>
<td align="right">34</td>
<td align="left">accuracy</td>
<td align="left">binary</td>
<td align="right">0.8406407</td>
<td align="right">10</td>
<td align="right">0.0000232</td>
<td align="left">Model10</td>
</tr>
<tr class="even">
<td align="right">0.0000150</td>
<td align="right">8</td>
<td align="right">34</td>
<td align="left">roc_auc</td>
<td align="left">binary</td>
<td align="right">0.5000000</td>
<td align="right">10</td>
<td align="right">0.0000000</td>
<td align="left">Model10</td>
</tr>
<tr class="odd">
<td align="right">0.0000000</td>
<td align="right">14</td>
<td align="right">33</td>
<td align="left">accuracy</td>
<td align="left">binary</td>
<td align="right">0.8397497</td>
<td align="right">10</td>
<td align="right">0.0002963</td>
<td align="left">Model11</td>
</tr>
<tr class="even">
<td align="right">0.0000000</td>
<td align="right">14</td>
<td align="right">33</td>
<td align="left">roc_auc</td>
<td align="left">binary</td>
<td align="right">0.6263418</td>
<td align="right">10</td>
<td align="right">0.0040858</td>
<td align="left">Model11</td>
</tr>
<tr class="odd">
<td align="right">0.0000000</td>
<td align="right">13</td>
<td align="right">16</td>
<td align="left">accuracy</td>
<td align="left">binary</td>
<td align="right">0.8381233</td>
<td align="right">10</td>
<td align="right">0.0001983</td>
<td align="left">Model12</td>
</tr>
<tr class="even">
<td align="right">0.0000000</td>
<td align="right">13</td>
<td align="right">16</td>
<td align="left">roc_auc</td>
<td align="left">binary</td>
<td align="right">0.6349699</td>
<td align="right">10</td>
<td align="right">0.0032979</td>
<td align="left">Model12</td>
</tr>
<tr class="odd">
<td align="right">0.0344537</td>
<td align="right">7</td>
<td align="right">31</td>
<td align="left">accuracy</td>
<td align="left">binary</td>
<td align="right">0.8406407</td>
<td align="right">10</td>
<td align="right">0.0000232</td>
<td align="left">Model13</td>
</tr>
<tr class="even">
<td align="right">0.0344537</td>
<td align="right">7</td>
<td align="right">31</td>
<td align="left">roc_auc</td>
<td align="left">binary</td>
<td align="right">0.5000000</td>
<td align="right">10</td>
<td align="right">0.0000000</td>
<td align="left">Model13</td>
</tr>
<tr class="odd">
<td align="right">0.0356874</td>
<td align="right">11</td>
<td align="right">37</td>
<td align="left">accuracy</td>
<td align="left">binary</td>
<td align="right">0.8406407</td>
<td align="right">10</td>
<td align="right">0.0000232</td>
<td align="left">Model14</td>
</tr>
<tr class="even">
<td align="right">0.0356874</td>
<td align="right">11</td>
<td align="right">37</td>
<td align="left">roc_auc</td>
<td align="left">binary</td>
<td align="right">0.5000000</td>
<td align="right">10</td>
<td align="right">0.0000000</td>
<td align="left">Model14</td>
</tr>
<tr class="odd">
<td align="right">0.0000000</td>
<td align="right">8</td>
<td align="right">35</td>
<td align="left">accuracy</td>
<td align="left">binary</td>
<td align="right">0.8406407</td>
<td align="right">10</td>
<td align="right">0.0000232</td>
<td align="left">Model15</td>
</tr>
<tr class="even">
<td align="right">0.0000000</td>
<td align="right">8</td>
<td align="right">35</td>
<td align="left">roc_auc</td>
<td align="left">binary</td>
<td align="right">0.5000000</td>
<td align="right">10</td>
<td align="right">0.0000000</td>
<td align="left">Model15</td>
</tr>
<tr class="odd">
<td align="right">0.0000001</td>
<td align="right">8</td>
<td align="right">16</td>
<td align="left">accuracy</td>
<td align="left">binary</td>
<td align="right">0.8404848</td>
<td align="right">10</td>
<td align="right">0.0000888</td>
<td align="left">Model16</td>
</tr>
<tr class="even">
<td align="right">0.0000001</td>
<td align="right">8</td>
<td align="right">16</td>
<td align="left">roc_auc</td>
<td align="left">binary</td>
<td align="right">0.6133944</td>
<td align="right">10</td>
<td align="right">0.0067255</td>
<td align="left">Model16</td>
</tr>
<tr class="odd">
<td align="right">0.0185553</td>
<td align="right">5</td>
<td align="right">2</td>
<td align="left">accuracy</td>
<td align="left">binary</td>
<td align="right">0.8406407</td>
<td align="right">10</td>
<td align="right">0.0000232</td>
<td align="left">Model17</td>
</tr>
<tr class="even">
<td align="right">0.0185553</td>
<td align="right">5</td>
<td align="right">2</td>
<td align="left">roc_auc</td>
<td align="left">binary</td>
<td align="right">0.5000000</td>
<td align="right">10</td>
<td align="right">0.0000000</td>
<td align="left">Model17</td>
</tr>
<tr class="odd">
<td align="right">0.0000337</td>
<td align="right">15</td>
<td align="right">15</td>
<td align="left">accuracy</td>
<td align="left">binary</td>
<td align="right">0.8380788</td>
<td align="right">10</td>
<td align="right">0.0002459</td>
<td align="left">Model18</td>
</tr>
<tr class="even">
<td align="right">0.0000337</td>
<td align="right">15</td>
<td align="right">15</td>
<td align="left">roc_auc</td>
<td align="left">binary</td>
<td align="right">0.6258610</td>
<td align="right">10</td>
<td align="right">0.0048791</td>
<td align="left">Model18</td>
</tr>
<tr class="odd">
<td align="right">0.0000000</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="left">accuracy</td>
<td align="left">binary</td>
<td align="right">0.8406407</td>
<td align="right">10</td>
<td align="right">0.0000232</td>
<td align="left">Model19</td>
</tr>
<tr class="even">
<td align="right">0.0000000</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="left">roc_auc</td>
<td align="left">binary</td>
<td align="right">0.5000000</td>
<td align="right">10</td>
<td align="right">0.0000000</td>
<td align="left">Model19</td>
</tr>
<tr class="odd">
<td align="right">0.0000019</td>
<td align="right">12</td>
<td align="right">26</td>
<td align="left">accuracy</td>
<td align="left">binary</td>
<td align="right">0.8397496</td>
<td align="right">10</td>
<td align="right">0.0001654</td>
<td align="left">Model20</td>
</tr>
<tr class="even">
<td align="right">0.0000019</td>
<td align="right">12</td>
<td align="right">26</td>
<td align="left">roc_auc</td>
<td align="left">binary</td>
<td align="right">0.6187251</td>
<td align="right">10</td>
<td align="right">0.0138764</td>
<td align="left">Model20</td>
</tr>
</tbody>
</table>
</div>
<pre class="r"><code>tree_res %&gt;%
  collect_predictions() %&gt;%
  group_by(id) %&gt;%
  roc_curve(truth=Class,.pred_stem) %&gt;%
  ggplot(aes(x=1-sensitivity,y=specificity,col=id))+
  geom_path(show.legend = FALSE, alpha = 0.6, size = 1.2) +
  geom_abline(lty = 2, color = &quot;gray80&quot;, size = 1.5) +
  theme_minimal()+
  coord_equal()</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>We do not see great results.</p>
<pre class="r"><code>tree_res %&gt;%
  select_best(metric=&quot;roc_auc&quot;)</code></pre>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">cost_complexity</th>
<th align="right">tree_depth</th>
<th align="right">min_n</th>
<th align="left">.config</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2.8e-06</td>
<td align="right">11</td>
<td align="right">4</td>
<td align="left">Model08</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="estimate-logistic-regression" class="section level3">
<h3><span class="header-section-number">2.4.2</span> Estimate Logistic Regression</h3>
<pre class="r"><code>lgst_fit = fit(lgst_wf,data=okc_train)</code></pre>
<pre class="r"><code>coefs = lgst_fit %&gt;%
  pull_workflow_fit() %&gt;%
  tidy()

coefs</code></pre>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">7.1115601</td>
<td align="right">0.3380275</td>
<td align="right">21.0384057</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="right">-0.0002797</td>
<td align="right">0.0019638</td>
<td align="right">-0.1424038</td>
<td align="right">0.8867610</td>
</tr>
<tr class="odd">
<td align="left">height</td>
<td align="right">-0.1024688</td>
<td align="right">0.0046800</td>
<td align="right">-21.8949886</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">diet_Halal</td>
<td align="right">0.0515111</td>
<td align="right">0.4466523</td>
<td align="right">0.1153270</td>
<td align="right">0.9081859</td>
</tr>
<tr class="odd">
<td align="left">diet_Kosher</td>
<td align="right">0.8325171</td>
<td align="right">0.4272224</td>
<td align="right">1.9486740</td>
<td align="right">0.0513344</td>
</tr>
<tr class="even">
<td align="left">diet_Other</td>
<td align="right">0.2191746</td>
<td align="right">0.1094641</td>
<td align="right">2.0022506</td>
<td align="right">0.0452578</td>
</tr>
<tr class="odd">
<td align="left">diet_Vegan</td>
<td align="right">0.3649844</td>
<td align="right">0.1702970</td>
<td align="right">2.1432231</td>
<td align="right">0.0320952</td>
</tr>
<tr class="even">
<td align="left">diet_Vegetarian</td>
<td align="right">0.1336157</td>
<td align="right">0.0652959</td>
<td align="right">2.0463123</td>
<td align="right">0.0407257</td>
</tr>
<tr class="odd">
<td align="left">diet_unknown</td>
<td align="right">0.1185543</td>
<td align="right">0.0368114</td>
<td align="right">3.2205865</td>
<td align="right">0.0012793</td>
</tr>
<tr class="even">
<td align="left">location_Oakland</td>
<td align="right">0.2397544</td>
<td align="right">0.0868536</td>
<td align="right">2.7604429</td>
<td align="right">0.0057723</td>
</tr>
<tr class="odd">
<td align="left">location_Other</td>
<td align="right">-0.0805340</td>
<td align="right">0.0742326</td>
<td align="right">-1.0848876</td>
<td align="right">0.2779714</td>
</tr>
<tr class="even">
<td align="left">location_San.Francisco</td>
<td align="right">-0.2217720</td>
<td align="right">0.0710128</td>
<td align="right">-3.1229854</td>
<td align="right">0.0017903</td>
</tr>
</tbody>
</table>
</div>
<pre class="r"><code>coefs %&gt;%
  filter(term!=&quot;(Intercept)&quot;)%&gt;%
  mutate(Significant = if_else(p.value &lt; 0.05,&quot;TRUE&quot;,&quot;FALSE&quot;)  ) %&gt;%
ggplot(aes(y=term,x=estimate,col=Significant))+
  geom_point()+
  geom_errorbar(aes(xmax=estimate+1.96*std.error,
                xmin=estimate-1.96*std.error
  ))+
  geom_vline(xintercept=0,lty=4,col=&quot;grey50&quot;)+
  theme_minimal()+
  labs(title=&quot;Coefficients Estimates&quot;,subtitle=&quot;Log Odds Ratio&quot;,col=&quot;Signifcant\nat 5% level&quot;)</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<p>What this is telling us, is that a unit increase in height, results in a unit increase of -0.105 for the log odds ratio of someone having a STEM major. The odds ratio is 0.9, this means that we expect to see a 10% decrease in odds ratio of someone being STEM, for a unit increase in height.</p>
<p>We see that Age is not a significant variable in determining the major of a person.</p>
<p>The baseline of the model is someone from Berkeley and has a diet of Anything. From a diet perspective, we see that someone being: Vegetarian, Vegan Unknown or Other, increases the odds of someone having a STEM Major. We do not see evidence that Kosher or Halal are different to Anything.</p>
<p>Location wise, Being at Oaklands, rather than Berkeley gives 17% increase in the odds of someone being STEM. Being at San Francisco is a 29% decrease in the oods of someone having a STEM Major, being from neither of these place results in a 20% decrease in the odds of someone being STEM.</p>
<pre class="r"><code>coefs %&gt;%
  filter(term !=&quot;(Intercept)&quot;)%&gt;%
  mutate(Odds_Ratio = exp(estimate)) %&gt;%
  select(term,Odds_Ratio)</code></pre>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">Odds_Ratio</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">age</td>
<td align="right">0.9997204</td>
</tr>
<tr class="even">
<td align="left">height</td>
<td align="right">0.9026063</td>
</tr>
<tr class="odd">
<td align="left">diet_Halal</td>
<td align="right">1.0528608</td>
</tr>
<tr class="even">
<td align="left">diet_Kosher</td>
<td align="right">2.2990986</td>
</tr>
<tr class="odd">
<td align="left">diet_Other</td>
<td align="right">1.2450486</td>
</tr>
<tr class="even">
<td align="left">diet_Vegan</td>
<td align="right">1.4404915</td>
</tr>
<tr class="odd">
<td align="left">diet_Vegetarian</td>
<td align="right">1.1429536</td>
</tr>
<tr class="even">
<td align="left">diet_unknown</td>
<td align="right">1.1258680</td>
</tr>
<tr class="odd">
<td align="left">location_Oakland</td>
<td align="right">1.2709370</td>
</tr>
<tr class="even">
<td align="left">location_Other</td>
<td align="right">0.9226235</td>
</tr>
<tr class="odd">
<td align="left">location_San.Francisco</td>
<td align="right">0.8010980</td>
</tr>
</tbody>
</table>
</div>
<pre class="r"><code>coefs %&gt;%
  filter(term != &quot;(Intercept)&quot;) %&gt;%
  mutate(Significant = if_else(p.value &lt; 0.05, &quot;TRUE&quot;, &quot;FALSE&quot;)) %&gt;%
  ggplot(aes(
    y = term,
    x = exp(estimate),
    col = Significant
  )) +
  geom_point() +
  geom_errorbar(aes(xmax = exp(estimate + 1.96 * std.error),
                xmin = exp(estimate - 1.96 * std.error))  
                )+
  geom_vline(xintercept = 1,
             lty = 4,
             col = &quot;grey50&quot;) +
  theme_minimal() +
  labs(title = &quot;Odds Ratio&quot;,col=&quot;Signifcant\nat 5% level&quot;)</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
</div>
<div id="evaluating-logistic-regression-performance" class="section level3">
<h3><span class="header-section-number">2.4.3</span> Evaluating Logistic Regression Performance</h3>
<p>We will use resampling to get an estimate on how the model performed on the training set.</p>
<pre class="r"><code>set.seed(8888)
lgst_train_rs = lgst_wf %&gt;%
  fit_resamples(
   resamples = vfold_cv(okc_train,strata = Class),
   metrics = metric_set(accuracy,roc_auc, sens, spec),
    control = control_resamples(save_pred = TRUE)
 )</code></pre>
<pre class="r"><code>lgst_train_rs %&gt;%
  collect_metrics()</code></pre>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">.metric</th>
<th align="left">.estimator</th>
<th align="right">mean</th>
<th align="right">n</th>
<th align="right">std_err</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">accuracy</td>
<td align="left">binary</td>
<td align="right">0.5713578</td>
<td align="right">10</td>
<td align="right">0.0031953</td>
</tr>
<tr class="even">
<td align="left">roc_auc</td>
<td align="left">binary</td>
<td align="right">0.6221339</td>
<td align="right">10</td>
<td align="right">0.0021738</td>
</tr>
<tr class="odd">
<td align="left">sens</td>
<td align="left">binary</td>
<td align="right">0.6260325</td>
<td align="right">10</td>
<td align="right">0.0048708</td>
</tr>
<tr class="even">
<td align="left">spec</td>
<td align="left">binary</td>
<td align="right">0.5609937</td>
<td align="right">10</td>
<td align="right">0.0035646</td>
</tr>
</tbody>
</table>
</div>
<pre class="r"><code>lgst_train_rs %&gt;%
  collect_predictions()%&gt;%
  group_by(id)  %&gt;%
  roc_curve(truth=Class,.pred_stem) %&gt;%
  ggplot(aes(x=1-sensitivity,y=specificity,col=id))+
  geom_path(show.legend = FALSE, alpha = 0.6, size = 1.2) +
  geom_abline(lty = 2, color = &quot;gray80&quot;, size = 1.5) +
  theme_minimal()+
  coord_equal()</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<p>Below we can see the ROC Curve, we don’t get good results on the tree model</p>
<pre class="r"><code>lgst_train_rs %&gt;%
  collect_predictions()%&gt;%
  group_by(id)%&gt;% 
  roc_curve(truth=Class,.pred_stem) %&gt;%
    mutate(model=&quot;Logistic&quot;) %&gt;%
  
  bind_rows(
    tree_res %&gt;%
  collect_predictions()%&gt;%
  group_by(id)%&gt;% 
  roc_curve(truth=Class,.pred_stem) %&gt;%
    mutate(model=&quot;Decision Tree&quot;)
) %&gt;%
  ggplot(aes(x=1-sensitivity,y=specificity,col=model))+
  geom_path(alpha = 0.7, size = 1) +
  geom_abline(lty = 2, color = &quot;gray80&quot;, size = 1.5) +
  theme_minimal()+
  coord_equal()</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
</div>
<div id="using-best-tree" class="section level3">
<h3><span class="header-section-number">2.4.4</span> Using Best Tree</h3>
<pre class="r"><code>best_tree = tree_res %&gt;% select_best(&quot;roc_auc&quot;)

final_tree_wf = 
  tree_wf %&gt;%
  finalize_workflow(best_tree)

final_tree_wf</code></pre>
<pre><code>## == Workflow ================================================================================================================================================================
## Preprocessor: Recipe
## Model: decision_tree()
## 
## -- Preprocessor ------------------------------------------------------------------------------------------------------------------------------------------------------------
## 1 Recipe Step
## 
## * step_unknown()
## 
## -- Model -------------------------------------------------------------------------------------------------------------------------------------------------------------------
## Decision Tree Model Specification (classification)
## 
## Main Arguments:
##   cost_complexity = 2.81310986908408e-06
##   tree_depth = 11
##   min_n = 4
## 
## Computational engine: rpart</code></pre>
<pre class="r"><code>library(vip)

final_tree = final_tree_wf %&gt;% fit(data=okc_train)

pull_final_tree= final_tree %&gt;%
  pull_workflow_fit()

pull_final_tree %&gt;%
  vip()</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<p>It appears from the plot, that height is the most important variable for the decision tree, followed by height.</p>
</div>
</div>
</div>
<div id="performance-on-test-set" class="section level1">
<h1><span class="header-section-number">3</span> Performance on Test Set</h1>
<p>We can see the roc_auc and accuracy.</p>
<pre class="r"><code>predict(lgst_fit,new_data = okc_test,type=&quot;prob&quot;) %&gt;%
   bind_cols(  okc_test %&gt;% select(Class)  ) %&gt;%
   roc_auc(truth=Class, .pred_stem) %&gt;%
  mutate(model=&quot;Logistic&quot;) %&gt;%
  bind_rows(

predict(final_tree,new_data = okc_test,type=&quot;prob&quot;) %&gt;%
   bind_cols(  okc_test %&gt;% select(Class)  ) %&gt;%
   roc_auc(truth=Class, .pred_stem)%&gt;%
  mutate(model=&quot;Decision Tree&quot;)
) %&gt;%
  select(model,.estimate,.metric) %&gt;%
  
  bind_rows(


predict(lgst_fit,new_data = okc_test)   %&gt;%
   bind_cols(  okc_test %&gt;% select(Class)  ) %&gt;%
   accuracy(truth=Class, .pred_class) %&gt;%
  mutate(model=&quot;Logistic&quot;) %&gt;%
  bind_rows(

predict(final_tree,new_data = okc_test)   %&gt;%
   bind_cols(  okc_test %&gt;% select(Class)  ) %&gt;%
   accuracy(truth=Class, .pred_class) %&gt;%
  mutate(model=&quot;Decision Tree&quot;)
) %&gt;%
  select(model,.estimate,.metric)

) %&gt;%
  pivot_wider(names_from = .metric,values_from=.estimate)</code></pre>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">model</th>
<th align="right">roc_auc</th>
<th align="right">accuracy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Logistic</td>
<td align="right">0.6343331</td>
<td align="right">0.5860571</td>
</tr>
<tr class="even">
<td align="left">Decision Tree</td>
<td align="right">0.6589016</td>
<td align="right">0.8389145</td>
</tr>
</tbody>
</table>
</div>
<p>In terms of roc_auc and accuracy, the decision tree is superior over the logistic model.</p>
<pre class="r"><code>predict(lgst_fit,new_data = okc_test,type=&quot;prob&quot;) %&gt;%
   bind_cols(  okc_test %&gt;% select(Class)  ) %&gt;%
   roc_curve(truth=Class, .pred_stem)%&gt;%
  mutate(model=&quot;Logistic&quot;) %&gt;%
  bind_rows(

predict(final_tree,new_data = okc_test,type=&quot;prob&quot;) %&gt;%
   bind_cols(  okc_test %&gt;% select(Class)  ) %&gt;%
   roc_curve(truth=Class, .pred_stem)%&gt;%
  mutate(model=&quot;Decision Tree&quot;)
) %&gt;%
  ggplot(aes(x=1-specificity,y=sensitivity,col=model))+
  geom_path(size=2)+
  geom_abline(slope=1,col=&quot;grey50&quot;,size=1.5,lty=8)+
  theme_minimal()+
  coord_equal()</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
<div id="confusion-matrices" class="section level3">
<h3><span class="header-section-number">3.0.1</span> Confusion Matrices</h3>
<pre class="r"><code>predict(lgst_fit,new_data = okc_test)   %&gt;%
   bind_cols(  okc_test %&gt;% select(Class)  ) %&gt;%
  conf_mat(truth=Class,.pred_class) %&gt;%
    autoplot(type=&quot;heatmap&quot;)</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
<pre class="r"><code>predict(final_tree,new_data = okc_test)   %&gt;%
   bind_cols(  okc_test %&gt;% select(Class)  ) %&gt;%
  conf_mat(truth=Class,.pred_class) %&gt;%
  autoplot(type=&quot;heatmap&quot;)</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
<p>However, upon further inspection, we see that the tree is just predicting <code>other</code> many times. The base line is</p>
<pre class="r"><code>paste0(&quot;Base Accuracy: &quot;,round((12546+31)/nrow(okc_test) *100,1),&quot;%&quot;)</code></pre>
<pre><code>## [1] &quot;Base Accuracy: 84.1%&quot;</code></pre>
<p>So in-fact, we did worse than always predicting the most common occurrence in our training set, which was to predict that someone was not a STEM major.</p>
</div>
</div>
<div id="post-hoc-analysis" class="section level1">
<h1><span class="header-section-number">4</span> Post-Hoc Analysis</h1>
<pre class="r"><code>summary(okc_train)</code></pre>
<pre><code>##       age                 diet           height              location    
##  Min.   : 18.00   Anything  :20839   Min.   :26.0   Berkeley     : 3156  
##  1st Qu.: 26.00   Halal     :   58   1st Qu.:66.0   Oakland      : 5391  
##  Median : 30.00   Kosher    :   90   Median :68.0   Other        :13040  
##  Mean   : 32.36   Other     : 1319   Mean   :68.3   San Francisco:23299  
##  3rd Qu.: 37.00   Vegan     :  532   3rd Qu.:71.0                        
##  Max.   :110.00   Vegetarian: 3745   Max.   :95.0                        
##                   NA&#39;s      :18303                                       
##    Class      
##  stem : 7153  
##  other:37733  
##               
##               
##               
##               
## </code></pre>
<p>We create a fake dataset to see what the models are predicting.</p>
<pre class="r"><code>fake_data_2 = expand_grid(
  age = (18:70),
  height = (60:80),
  location = c(&quot;San Francisco&quot;, &quot;Oakland&quot;, &quot;Other&quot;, &quot;Berkeley&quot;),
  diet = c(&quot;Halal&quot;, &quot;Kosher&quot;,&quot;Anything&quot;,&quot;Other&quot;,NA, &quot;Vegan&quot;, &quot;Vegetarian&quot;)
)</code></pre>
<pre class="r"><code>predict(lgst_fit,new_data=fake_data_2) %&gt;%
  rename(Pred =  .pred_class) %&gt;%
  bind_cols(fake_data_2) %&gt;%
  ggplot(aes(x=age,y=height,fill=Pred))+
  geom_tile()+
  theme_bw()+
  facet_grid(diet~location)+
  labs(title=&quot;Logistic Model Predictions of Various Users\nWith Different Age, Height, Location and Diet&quot;)</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-49-1.png" width="672" /></p>
<pre class="r"><code>predict(final_tree,new_data=fake_data_2) %&gt;%
  rename(Pred =  .pred_class) %&gt;%
  bind_cols(fake_data_2) %&gt;%
  ggplot(aes(x=age,y=height,fill=Pred))+
  geom_tile()+
  theme_bw()+
  facet_grid(diet~location)+
  labs(title=&quot;Decision Tree Model Predictions of Various Users\nWith Different Age, Height, Location and Diet&quot;)</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
<pre class="r"><code>lgst_cmb_preds= predict(lgst_fit,new_data = okc_test) %&gt;%
  bind_cols(okc_test) %&gt;%
  mutate( Result =   case_when( .pred_class == &quot;stem&quot;  &amp; Class==&quot;stem&quot;  ~ &quot;TP&quot;,
                                 .pred_class == &quot;other&quot;  &amp; Class==&quot;other&quot;  ~ &quot;TN&quot;,
                                 .pred_class == &quot;stem&quot;  &amp; Class==&quot;other&quot;  ~ &quot;FP&quot;,
                                  .pred_class == &quot;other&quot;  &amp; Class==&quot;stem&quot;  ~ &quot;FN&quot;
                                )) %&gt;%
  rename(Pred = .pred_class)</code></pre>
<pre class="r"><code>  ggplot()+
  geom_point( data= lgst_cmb_preds%&gt;%filter(Result %in% c(&quot;FN&quot;,&quot;FP&quot;)) ,mapping=aes(x=age,y=height),col=&quot;grey&quot;,alpha=0.8)+
  geom_point( data= lgst_cmb_preds%&gt;%filter(!Result %in% c(&quot;FN&quot;,&quot;FP&quot;)) ,mapping=aes(x=age,y=height,col=Result),alpha=0.8)+
  theme_bw()+
  facet_grid(diet~location)+
  scale_color_manual(values = c(&quot;royalblue4&quot;,&quot;indianred4&quot;))+
  labs(title=&quot;Logistic Model with True Positives and True Negatives&quot;)</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-52-1.png" width="672" /></p>
<pre class="r"><code>  ggplot()+
  geom_point( data= lgst_cmb_preds%&gt;%filter(!Result %in% c(&quot;FN&quot;,&quot;FP&quot;)) ,mapping=aes(x=age,y=height),col=&quot;grey&quot;,alpha=0.8)+
  geom_point( data= lgst_cmb_preds%&gt;%filter(Result %in% c(&quot;FN&quot;,&quot;FP&quot;)) ,mapping=aes(x=age,y=height,col=Result),alpha=0.8)+
  theme_bw()+
  facet_grid(diet~location)+
  scale_color_manual(values = c(&quot;royalblue1&quot;,&quot;indianred1&quot;))+
  labs(title=&quot;Logistic Model with False Positives and False Negatives&quot;)</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-53-1.png" width="672" /></p>
<p>We see that the Logistic Model harshly classifies based on height.</p>
<pre class="r"><code>ggplot(okc_train,aes(x=age,y=height,col=Class))+
  geom_point(alpha=0.8)+
  theme_bw()+
  facet_grid(diet~location)+
  scale_color_manual(values = c(&quot;seagreen&quot;,&quot;mediumpurple3&quot;))+
  labs(title=&quot;OKC Training Set&quot;)</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-54-1.png" width="672" /></p>
<pre class="r"><code>ggplot(okc_test,aes(x=age,y=height,col=Class))+
  geom_point(alpha=0.8)+
  theme_bw()+
  facet_grid(diet~location)+
  scale_color_manual(values = c(&quot;seagreen&quot;,&quot;mediumpurple3&quot;))+
  labs(title=&quot;OKC Test Set&quot;)</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-55-1.png" width="672" /></p>
<pre class="r"><code>predict(lgst_fit,new_data=fake_data_2,type=&quot;prob&quot;) %&gt;%
  #rename(Pred =  .pred_class) %&gt;%
  bind_cols(fake_data_2) %&gt;%
  ggplot(aes(x=age,y=height,fill=.pred_other))+
  geom_tile()+
  theme_bw()+
  facet_grid(diet~location)+
  scale_fill_gradientn(colours =  RColorBrewer::brewer.pal(n = 11, name = &#39;PRGn&#39;))+
  #scale_fill_brewer(palette = RColorBrewer::brewer.pal(n = 10, name = &#39;PRGn&#39;))+
  labs(title=&quot;Logistic Model Probabilities of Various Users\nWith Different Age, Height, Location and Diet&quot;)</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-56-1.png" width="672" /></p>
<pre class="r"><code>predict(final_tree,new_data=fake_data_2,type=&quot;prob&quot;) %&gt;%
  #rename(Pred =  .pred_class) %&gt;%
  bind_cols(fake_data_2) %&gt;%
  ggplot(aes(x=age,y=height,fill=.pred_stem))+
  geom_tile()+
  theme_bw()+
  facet_grid(diet~location)+
  scale_fill_gradientn(colours =  RColorBrewer::brewer.pal(n=9,name=&quot;Reds&quot;))+
  labs(title=&quot;Tree Model Probabilities of Various Users Being STEM\nWith Different Age, Height, Location and Diet&quot;)</code></pre>
<p><img src="OKCupidDataAnalysis_files/figure-html/unnamed-chunk-57-1.png" width="672" /></p>
</div>
<div id="conclusion" class="section level1">
<h1><span class="header-section-number">5</span> Conclusion</h1>
<p>It appears that it is difficult to predict whether a user has a STEM Major. Perhaps using something like a Random Forest or KNN may yield better results, as it can model complex interactions. Either way, it appears using simple approaches does not give good results.</p>
<p>We also have a large class imbalance, to remedy this problem, using something like the SMOTE algorithm to create synthetic data may help.</p>
<p>Another approach would be to combine the two models in order to create an ensemble model. We can also add other models to get better predictions. The Logistic model was much better in finding the true positives, while the Decision Tree was poor in this regard.</p>
<p>It could also be the case that we just don’t have enough good, quality data to predict such a rare event. If we had other features, we could perhaps be in a better position to predict better.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
